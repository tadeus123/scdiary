<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>corner</title>
  <link rel="stylesheet" href="/css/style.css">
  
  <!-- Preload bookshelf resources for instant loading -->
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="dns-prefetch" href="https://unpkg.com">
  <link rel="prefetch" href="/bookshelf" as="document">
  <link rel="prefetch" href="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js" as="script">
  <link rel="prefetch" href="/js/bookshelf.js" as="script">
</head>
<body class="corner-page">
  <a href="/" class="corner-btn-left" aria-label="Back to Diary"></a>
  <a href="/bookshelf" class="bookshelf-text">show me your bookshelf and I know who you are...</a>
  
  <div class="corner-gallery">
    <div class="corner-image-stack" id="corner-image-stack">
      <!-- Images will be loaded dynamically -->
    </div>
  </div>
  
  <script src="/js/main.js"></script>
  <script src="/js/corner.js"></script>
  
  <!-- Smart hover-based prefetch for instant bookshelf loading -->
  <script>
    (function() {
      // Store prefetched data globally so bookshelf.js can use it
      window.__prefetchedBookshelfData__ = null;
      window.__prefetchedReadingTime__ = null;
      let prefetchStarted = false;
      
      async function startPrefetch() {
        if (prefetchStarted) return;
        prefetchStarted = true;
        
        try {
          // Prefetch books data and store it
          const booksResponse = await fetch(`/api/books?t=${Date.now()}`);
          if (booksResponse.ok) {
            const data = await booksResponse.json();
            window.__prefetchedBookshelfData__ = data;
            
            // Preload book cover images
            if (data.success && data.books) {
              data.books.forEach(book => {
                if (book.cover_image_url) {
                  const img = new Image();
                  img.src = book.cover_image_url;
                }
              });
            }
          }
          
          // Prefetch reading time
          const readingTimeResponse = await fetch(`/api/books/total-reading-time?t=${Date.now()}`);
          if (readingTimeResponse.ok) {
            window.__prefetchedReadingTime__ = await readingTimeResponse.json();
          }
        } catch (error) {
          console.log('Prefetch failed, will load normally');
        }
      }
      
      // Start prefetching when user hovers over the bookshelf link
      document.addEventListener('DOMContentLoaded', () => {
        const bookshelfLink = document.querySelector('.bookshelf-text');
        if (bookshelfLink) {
          bookshelfLink.addEventListener('mouseenter', startPrefetch);
          bookshelfLink.addEventListener('touchstart', startPrefetch, { passive: true });
        }
      });
    })();
  </script>
</body>
</html>
